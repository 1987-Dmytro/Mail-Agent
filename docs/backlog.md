# Engineering Backlog

This backlog collects cross-cutting or future action items that emerge from reviews and planning.

Routing guidance:

- Use this file for non-urgent optimizations, refactors, or follow-ups that span multiple stories/epics.
- Must-fix items to ship a story belong in that story's `Tasks / Subtasks`.
- Same-epic improvements may also be captured under the epic Tech Spec `Post-Review Follow-ups` section.

| Date | Story | Epic | Type | Severity | Owner | Status | Notes |
| ---- | ----- | ---- | ---- | -------- | ----- | ------ | ----- |
| 2025-11-05 | 1.6 | 1 | Enhancement | Medium | TBD | Open | Make Gmail API max_results configurable via environment variable (currently hard-coded to 50). File: backend/app/tasks/email_tasks.py:109 |
| 2025-11-05 | 1.6 | 1 | Enhancement | Medium | TBD | Open | Add validation for gmail_refresh_token presence before spawning poll task to prevent unnecessary task execution. File: backend/app/tasks/email_tasks.py:170 |
| 2025-11-05 | 1.6 | 1 | TechDebt | Low | TBD | Open | Optimize event loop management in Celery tasks - avoid creating new loop on each task execution for better performance. File: backend/app/tasks/email_tasks.py:43-46 |
| 2025-11-05 | 1.6 | 1 | Enhancement | Low | TBD | Open | Automate integration tests for CI/CD pipeline (currently manual). Create automated end-to-end test suite for email polling flow. File: backend/tests/ |
| 2025-11-05 | 1.8 | 1 | Bug | High | TBD | Open | Add FolderCategories documentation section to README.md - table schema, usage patterns, example API requests, color/visibility options. File: backend/README.md:334 |
| 2025-11-05 | 1.8 | 1 | Bug | High | TBD | Open | Add Gmail label management flow diagram to architecture.md showing label creation/application workflow, error handling flow (409/404), with sequence diagram. File: docs/architecture.md |
| 2025-11-05 | 1.8 | 1 | TechDebt | Medium | TBD | Open | Create test_folder_service.py with service integration tests - test_create_folder_end_to_end, test_list_folders_by_user, test_delete_folder, test_duplicate_folder_name_error. File: backend/tests/test_folder_service.py |
| 2025-11-05 | 1.9 | 1 | Bug | High | TBD | Open | Create integration test file backend/tests/test_email_integration.py with test_send_email_end_to_end, test_send_email_with_thread_reply, test_send_email_error_handling. Verify JWT auth integration with email sending. Task 9 marked complete but file does NOT exist. |
| 2025-11-05 | 1.9 | 1 | Bug | High | TBD | Open | Add Email Sending section to backend/README.md - document send_email() signature, MIME composition, threading headers, example API request for /test/send-email, error codes (QuotaExceededError, InvalidRecipientError, MessageTooLargeError), Gmail quota limits (10K requests/day, 100 sends/day). Task 10 marked complete but section missing. |
| 2025-11-05 | 1.9 | 1 | Bug | High | TBD | Open | Update docs/architecture.md with Email Sending Flow - add sequence diagram (User → Backend → GmailClient → Gmail API), MIME message structure, threading header construction, error handling flow, Gmail sending quotas in Rate Limits section. Task 10 marked complete but documentation incomplete. |
| 2025-11-05 | 1.9 | 1 | TechDebt | Medium | TBD | Open | Add explicit retry logic test test_send_email_retry_on_network_error() - mock 503 error, verify _execute_with_retry() triggers 3 retries with exponential backoff (2s, 4s, 8s). File: backend/tests/test_email_sending.py |
| 2025-11-05 | 1.9 | 1 | TechDebt | Medium | TBD | Open | Add explicit logging test test_send_email_logging() - mock send_email(), capture structured logs, verify email_sent event has all fields (user_id, recipient, subject, message_id, timestamp, success=True), verify no body content logged (GDPR). File: backend/tests/test_email_sending.py |
| 2025-11-05 | 1.9 | 1 | TechDebt | Medium | TBD | Open | Run pytest coverage report for email sending - execute pytest tests/test_email_sending.py --cov=app.core.gmail_client --cov-report=html and verify 100% coverage claim for send_email() and _compose_mime_message(). Task 8 claims 100% but coverage not measured. |
| 2025-11-08 | 2.10 | 2 | Enhancement | Low | TBD | Open | Consider caching folder names in get_approval_statistics() to avoid joining FolderCategory on every call (Performance optimization). File: backend/app/services/approval_history.py:314-338 |
| 2025-11-09 | 3.1 | 3 | TechDebt | Medium | TBD | Open | Update story file: Mark all completed task checkboxes with [x] (16 subtasks in Tasks/Subtasks section). File: docs/stories/3-1-vector-database-setup.md:70-183 |
| 2025-11-09 | 3.1 | 3 | TechDebt | Medium | TBD | Open | Update story file: Mark all completed DoD checklist items with [x] (7 items in Definition of Done section). File: docs/stories/3-1-vector-database-setup.md:33-68 |
| 2025-11-09 | 3.3 | 3 | Bug | High | TBD | Open | Implement Task 2: Create backend/tests/integration/test_indexing_integration.py with 5 required integration test scenarios (AC #1-12). Story marked complete but integration tests completely missing - 0 of 5 tests exist. BLOCKING ISSUE. File: backend/tests/integration/test_indexing_integration.py |
| 2025-11-09 | 3.3 | 3 | Bug | High | TBD | Open | Implement test_complete_indexing_workflow_90_days() integration test (AC #1-10) - end-to-end test for 90-day indexing workflow with progress tracking and Telegram notification. File: backend/tests/integration/test_indexing_integration.py |
| 2025-11-09 | 3.3 | 3 | Bug | High | TBD | Open | Implement test_indexing_resumption_after_interruption() integration test (AC #9) - verify checkpoint mechanism resumes from last_processed_message_id, prevents duplicate embeddings. File: backend/tests/integration/test_indexing_integration.py |
| 2025-11-09 | 3.3 | 3 | Bug | High | TBD | Open | Implement test_batch_processing_rate_limiting() integration test (AC #7, NFR005) - verify ~60s delays between batches, validate 90-day indexing (500 emails) completes <10 minutes. File: backend/tests/integration/test_indexing_integration.py |
| 2025-11-09 | 3.3 | 3 | Bug | High | TBD | Open | Implement test_error_handling_and_retry_logic() integration test (AC #12) - simulate Gmail API 429 rate limit, verify exponential backoff (60s, 120s, 240s), eventual success or failure status. File: backend/tests/integration/test_indexing_integration.py |
| 2025-11-09 | 3.3 | 3 | Bug | High | TBD | Open | Implement test_incremental_indexing_new_email() integration test (AC #11) - verify new emails indexed immediately after initial sync, no batch delay for single emails. File: backend/tests/integration/test_indexing_integration.py |
| 2025-11-09 | 3.3 | 3 | TechDebt | Medium | TBD | Open | Update story Status field from "ready-for-dev" to "review" to match sprint-status.yaml. File: docs/stories/3-3-email-history-indexing.md:3 |
| 2025-11-09 | 3.3 | 3 | TechDebt | Medium | TBD | Open | Check all completed Task checkboxes in story file (Tasks 1, 2, 3, 4 subtasks) - currently all unchecked despite dev claiming completion. File: docs/stories/3-3-email-history-indexing.md:73-263 |
| 2025-11-09 | 3.3 | 3 | TechDebt | Medium | TBD | Open | Check all completed DoD checklist items in story file - currently all remain [ ] despite story marked review-ready. File: docs/stories/3-3-email-history-indexing.md:38-72 |
| 2025-11-09 | 3.3 | 3 | TechDebt | Medium | TBD | Open | Remove or correct false claim "Integration tests skipped per story instructions (unit tests sufficient)" from Dev Agent Record completion notes - story explicitly requires integration tests. File: docs/stories/3-3-email-history-indexing.md:530 |
| 2025-11-18 | 4.9 | 4 | Bug | Medium | TBD | Open | Update test `test_oauth_initiation_constructs_url` to extract state from auth_url instead of mocking crypto.randomUUID - test expects frontend to generate state via crypto.randomUUID() but implementation correctly extracts state from backend-provided auth_url (GmailConnect.tsx:240-249). File: tests/components/gmail-connect.test.tsx:143-182 |
| 2025-11-18 | 4.9 | 4 | TechDebt | Medium | TBD | Open | Update AC 4 text from "Check response.data.client_id" to "Check response.data.auth_url" - AC text says "client_id" but implementation correctly checks "auth_url" per root cause analysis (story lines 288-294). File: docs/stories/story-4-9-fix-oauth-error.md:66 |
| 2025-11-18 | 4.9 | 4 | TechDebt | Low | TBD | Open | Update story Dev Agent Record to reflect actual react-error-boundary version (6.0.0 not 4.1.2) - story says "react-error-boundary@^4.1.2" but actual installed version is "6.0.0" (package.json:42). File: docs/stories/story-4-9-fix-oauth-error.md:312 |
