<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>1.1</storyId>
    <title>Project Infrastructure Setup</title>
    <status>drafted</status>
    <generatedAt>2025-11-03</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-1-project-infrastructure-setup.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>developer</asA>
    <iWant>to initialize the project repository with proper structure and development tools</iWant>
    <soThat>I have a clean, organized foundation for building the application</soThat>
    <tasks>
      - Initialize Git repository and create .gitignore
      - Set up project directory structure (backend/, frontend/, docs/, .github/)
      - Create comprehensive README.md with setup instructions
      - Document virtual environment setup (venv)
      - Create environment variables template (.env.example)
      - Verify and test setup with fresh clone
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Git repository initialized with .gitignore for Python/Node.js projects</criterion>
    <criterion id="2">Project structure created with separate folders for backend (Python), frontend (Next.js), and shared configs</criterion>
    <criterion id="3">README.md created with project overview and setup instructions</criterion>
    <criterion id="4">Development environment documentation includes required tools (Python 3.13+, Node.js, etc.)</criterion>
    <criterion id="5">Virtual environment setup instructions documented (venv or poetry)</criterion>
    <criterion id="6">Environment variables template file (.env.example) created for API keys and configs</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>Epic List</section>
        <snippet>Epic 1: Foundation & Gmail Integration (Est. 8-12 stories) - Goal: Establish project infrastructure and Gmail connectivity foundation, enabling basic email reading capabilities</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Story 1.1: Project Infrastructure Setup</section>
        <snippet>Complete acceptance criteria including: Git repository initialized with .gitignore for Python/Node.js projects, Project structure created with separate folders for backend (Python), frontend (Next.js), and shared configs, README.md created with project overview and setup instructions, Development environment documentation includes required tools (Python 3.13+, Node.js, etc.), Virtual environment setup instructions documented (venv or poetry), Environment variables template file (.env.example) created for API keys and configs</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture</title>
        <section>Project Structure</section>
        <snippet>Canonical project structure defined: mail-agent/ with backend/ (FastAPI + LangGraph service), frontend/ (Next.js configuration UI), docs/ (project documentation), .github/workflows/ (CI/CD pipelines). Backend follows template structure from wassim249/fastapi-langgraph-agent-production-ready-template.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture</title>
        <section>Project Initialization</section>
        <snippet>Backend setup: Clone template, create virtual environment (python3.13 -m venv venv), install dependencies from requirements.txt, configure .env with API keys, run database migrations (alembic upgrade head), start development server (uvicorn). Frontend setup: Create Next.js project with TypeScript and Tailwind, initialize shadcn/ui, install dependencies, configure environment.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture</title>
        <section>Development Environment - Prerequisites</section>
        <snippet>Required tools: Python 3.13+, Node.js 20+ and npm, Docker and Docker Compose, Git. Recommended: VS Code with Python extension, Postman or HTTPie (API testing), pgAdmin or DBeaver (database management).</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Decision Architecture</title>
        <section>Security Architecture</section>
        <snippet>.gitignore MUST include: .env, *.env, venv/, __pycache__/. .env.example shows structure but contains NO real secrets (placeholder values). README.md must warn users to NEVER commit .env files. Encryption key generation documented but NOT included in repository.</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic 1 Technical Specification</title>
        <section>Dependencies and Integrations - Configuration Requirements</section>
        <snippet>.env file configuration includes: DATABASE_URL, REDIS_URL, GMAIL_CLIENT_ID, GMAIL_CLIENT_SECRET, GMAIL_REDIRECT_URI, ENCRYPTION_KEY, JWT_SECRET_KEY, JWT_ALGORITHM, JWT_EXPIRATION_HOURS, ENVIRONMENT (development/staging/production), LOG_LEVEL (DEBUG/INFO/WARN/ERROR)</snippet>
      </doc>
      <doc>
        <path>docs/tech-spec-epic-1.md</path>
        <title>Epic 1 Technical Specification</title>
        <section>Acceptance Criteria - AC 1-3</section>
        <snippet>AC1: Git repository initialized with .gitignore for Python/Node.js projects. AC2: Project structure created with separate folders for backend (Python), frontend (Next.js), and shared configs. AC3: README.md created with project overview and setup instructions.</snippet>
      </doc>
    </docs>
    <code>
      <!-- No existing code artifacts yet - this is the first story establishing the foundation -->
    </code>
    <dependencies>
      <!-- Backend dependencies will be established in Story 1.2 via template -->
      <python>
        <note>Backend dependencies will be added via FastAPI + LangGraph template in Story 1.2</note>
        <expectedPackages>
          fastapi==0.120.4
          sqlalchemy[asyncio]==2.0.36
          alembic==1.13.3
          psycopg[binary]==3.2.3
          google-api-python-client==2.146.0
          google-auth==2.34.0
          cryptography==43.0.1
          celery[redis]==5.4.0
          redis==5.1.1
        </expectedPackages>
      </python>
      <node>
        <note>Frontend dependencies will be added in Epic 4, Story 4.1</note>
        <expectedPackages>
          next@15.5
          react@18.x
          typescript@5.x
          tailwindcss@latest
          shadcn-ui@latest
        </expectedPackages>
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="directory-structure">
      Project structure must match architecture.md specification exactly:
      - backend/ for FastAPI + LangGraph service
      - frontend/ for Next.js UI (minimal placeholder for now, populated in Epic 4)
      - docs/ already exists with PRD, architecture, epics, tech-spec
      - .github/workflows/ for future CI/CD
    </constraint>
    <constraint type="security">
      .gitignore MUST prevent committing sensitive files:
      - .env and *.env files
      - venv/ directory
      - __pycache__/ directories
      - node_modules/ directory
      - .next/ build directory
      - IDE-specific files (.vscode/, .idea/)
    </constraint>
    <constraint type="documentation">
      README.md must be beginner-friendly (NFR005 - Usability):
      - Clear project overview (what is Mail Agent?)
      - Prerequisites with exact version requirements
      - Step-by-step setup instructions
      - Troubleshooting section
      - Links to detailed documentation
    </constraint>
    <constraint type="environment-variables">
      .env.example must include ALL required variables with:
      - Inline comments explaining each variable
      - Placeholder values (NOT real secrets)
      - Documentation on where to obtain API keys
      - Security warning about never committing .env
    </constraint>
    <constraint type="template-preparation">
      Structure must accommodate FastAPI + LangGraph template in Story 1.2:
      - backend/ will be populated by cloning template
      - Template URL: https://github.com/wassim249/fastapi-langgraph-agent-production-ready-template
      - Do NOT create backend code in this story - just directory structure
    </constraint>
  </constraints>

  <interfaces>
    <!-- No existing interfaces yet - this is infrastructure setup -->
    <interface>
      <name>Project Repository Structure</name>
      <kind>directory-layout</kind>
      <signature>
        mail-agent/
        ├── backend/           # FastAPI + LangGraph (populated in Story 1.2)
        ├── frontend/          # Next.js (populated in Epic 4)
        ├── docs/              # Project documentation (already exists)
        │   ├── PRD.md
        │   ├── architecture.md
        │   ├── epics.md
        │   ├── tech-spec-epic-1.md
        │   └── stories/       # Story files
        ├── .github/
        │   └── workflows/     # CI/CD (future)
        ├── .gitignore
        ├── README.md
        └── .env.example       # To be created in backend/
      </signature>
      <path>Project root directory</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      This story has no automated tests (infrastructure setup). Validation is manual:
      - Fresh clone test: Clone repository to new directory and follow README.md setup steps exactly
      - Checklist validation: All 6 acceptance criteria must pass
      - Documentation quality: Can a beginner follow the instructions without confusion?
      - Security check: Verify .gitignore prevents committing .env files

      Future stories will use: pytest (Python backend testing), Jest/Vitest (Node.js frontend testing), integration tests with mocked external APIs.
    </standards>
    <locations>
      tests/ directory structure will be established in Story 1.10 (Integration Testing and Documentation)
      Expected locations:
      - backend/tests/unit/ - Unit tests for services, models, clients
      - backend/tests/integration/ - Integration tests for API endpoints, workflows
      - backend/tests/fixtures/ - Test data and mocks
      - frontend/src/__tests__/ - Frontend component tests
    </locations>
    <ideas>
      <idea ac="1">Verify .gitignore includes: .env, *.env, venv/, __pycache__/, node_modules/, .next/, .vscode/, .idea/</idea>
      <idea ac="2">Check directory structure: backend/, frontend/, docs/, .github/workflows/ all exist</idea>
      <idea ac="3">README.md includes: project overview, prerequisites (Python 3.13+, Node.js 20+, Docker, Git), quick start guide</idea>
      <idea ac="4">README.md documents all required tools with version numbers</idea>
      <idea ac="5">backend/README.md or main README.md includes venv setup: python3.13 -m venv venv, source venv/bin/activate (macOS/Linux), venv\Scripts\activate (Windows)</idea>
      <idea ac="6">backend/.env.example includes all required variables: DATABASE_URL, REDIS_URL, GMAIL_CLIENT_ID, GMAIL_CLIENT_SECRET, TELEGRAM_BOT_TOKEN, GEMINI_API_KEY, ENCRYPTION_KEY, JWT_SECRET_KEY, JWT_ALGORITHM, JWT_EXPIRATION_HOURS, ENVIRONMENT, LOG_LEVEL with inline comments</idea>
    </ideas>
  </tests>
</story-context>
